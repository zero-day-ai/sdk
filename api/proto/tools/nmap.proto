syntax = "proto3";
package gibson.tools;
option go_package = "github.com/zero-day-ai/sdk/api/gen/toolspb";

// ScanType defines the type of nmap scan to perform
enum ScanType {
    // Sentinel value - must be first
    SCAN_TYPE_UNSPECIFIED = 0;

    // SYN scan (default, stealthy, requires root)
    SCAN_TYPE_SYN = 1;

    // Connect scan (completes TCP handshake)
    SCAN_TYPE_CONNECT = 2;

    // UDP scan
    SCAN_TYPE_UDP = 3;

    // ACK scan (for firewall rule detection)
    SCAN_TYPE_ACK = 4;

    // Window scan
    SCAN_TYPE_WINDOW = 5;

    // Maimon scan
    SCAN_TYPE_MAIMON = 6;

    // Null scan (no flags set)
    SCAN_TYPE_NULL = 7;

    // FIN scan
    SCAN_TYPE_FIN = 8;

    // Xmas scan (FIN, PSH, URG flags)
    SCAN_TYPE_XMAS = 9;

    // SCTP INIT scan
    SCAN_TYPE_SCTP_INIT = 10;

    // SCTP COOKIE ECHO scan
    SCAN_TYPE_SCTP_COOKIE_ECHO = 11;

    // Ping scan only (no port scan)
    SCAN_TYPE_PING = 12;
}

// TimingTemplate defines nmap timing templates (T0-T5)
enum TimingTemplate {
    // Sentinel value - must be first
    TIMING_TEMPLATE_UNSPECIFIED = 0;

    // T0 - Paranoid (very slow, IDS evasion)
    TIMING_TEMPLATE_PARANOID = 1;

    // T1 - Sneaky (slow, IDS evasion)
    TIMING_TEMPLATE_SNEAKY = 2;

    // T2 - Polite (slow, less bandwidth)
    TIMING_TEMPLATE_POLITE = 3;

    // T3 - Normal (default)
    TIMING_TEMPLATE_NORMAL = 4;

    // T4 - Aggressive (fast, assumes good network)
    TIMING_TEMPLATE_AGGRESSIVE = 5;

    // T5 - Insane (very fast, may sacrifice accuracy)
    TIMING_TEMPLATE_INSANE = 6;
}

// NmapRequest represents input for the nmap tool
message NmapRequest {
    // Targets is the list of hosts or networks to scan (required)
    repeated string targets = 1;

    // Ports specifies the ports to scan (e.g., "80,443,8080", "1-1024", "T:80,U:53")
    string ports = 2;

    // ScanType is the type of scan to perform
    ScanType scan_type = 3;

    // Timing is the timing template
    TimingTemplate timing = 4;

    // ServiceDetection enables service version detection (-sV)
    bool service_detection = 5;

    // OSDetection enables OS detection (-O)
    bool os_detection = 6;

    // AggressiveScan enables aggressive scanning (-A: OS, version, script, traceroute)
    bool aggressive_scan = 7;

    // ScriptScan enables default script scanning (--script=default)
    bool script_scan = 8;

    // Scripts specifies custom NSE scripts to run
    repeated string scripts = 9;

    // FragmentPackets enables packet fragmentation for IDS evasion
    bool fragment_packets = 10;

    // Decoys specifies decoy IP addresses for scan obfuscation
    repeated string decoys = 11;

    // SourcePort specifies the source port to use
    int32 source_port = 12;

    // DataLength adds random data to sent packets
    int32 data_length = 13;

    // MaxRetries is the maximum number of port scan probe retransmissions
    int32 max_retries = 14;

    // HostTimeout is the timeout per host in seconds
    int32 host_timeout = 15;

    // ScanDelay is the delay between probes in milliseconds
    int32 scan_delay = 16;

    // MaxScanDelay is the maximum delay between probes
    int32 max_scan_delay = 17;

    // MinRate is the minimum packets per second
    int32 min_rate = 18;

    // MaxRate is the maximum packets per second
    int32 max_rate = 19;

    // DisableDNS disables DNS resolution
    bool disable_dns = 20;

    // DisablePing skips host discovery (treat all hosts as online)
    bool disable_ping = 21;

    // IPv6 enables IPv6 scanning
    bool ipv6 = 22;

    // Privileged runs nmap in privileged mode
    bool privileged = 23;
}

// NmapResponse represents output from the nmap tool
message NmapResponse {
    // Hosts contains the scan results for each host
    repeated NmapHost hosts = 1;

    // TotalHosts is the total number of hosts scanned
    int32 total_hosts = 2;

    // HostsUp is the number of hosts that responded
    int32 hosts_up = 3;

    // HostsDown is the number of hosts that didn't respond
    int32 hosts_down = 4;

    // ScanDuration is the scan duration in seconds
    double scan_duration = 5;

    // NmapVersion is the version of nmap used
    string nmap_version = 6;

    // Args contains the command-line arguments used
    string args = 7;

    // StartTime is the scan start timestamp
    int64 start_time = 8;

    // EndTime is the scan end timestamp
    int64 end_time = 9;
}

// NmapHost represents a single scanned host
message NmapHost {
    // IP is the host IP address
    string ip = 1;

    // Hostname is the resolved hostname (if available)
    string hostname = 2;

    // State is the host state (up, down, unknown)
    string state = 3;

    // StateReason is the reason for the host state
    string state_reason = 4;

    // Ports contains the scanned ports
    repeated NmapPort ports = 5;

    // OS contains OS detection results
    repeated OSMatch os_matches = 6;

    // Uptime is the host uptime in seconds (if detected)
    int64 uptime = 7;

    // LastBoot is the estimated last boot time (if detected)
    string last_boot = 8;

    // Distance is the network distance (hops) to the host
    int32 distance = 9;

    // Scripts contains NSE script output
    map<string, string> scripts = 10;

    // Hostnames contains all discovered hostnames
    repeated string hostnames = 11;
}

// NmapPort represents a single scanned port
message NmapPort {
    // Number is the port number
    int32 number = 1;

    // Protocol is the protocol (tcp, udp, sctp)
    string protocol = 2;

    // State is the port state (open, closed, filtered, unfiltered, open|filtered, closed|filtered)
    string state = 3;

    // StateReason is the reason for the port state
    string state_reason = 4;

    // Service contains service detection information
    NmapService service = 5;

    // Scripts contains NSE script output for this port
    map<string, string> scripts = 6;
}

// NmapService represents service information for a port
message NmapService {
    // Name is the service name (http, ssh, mysql, etc.)
    string name = 1;

    // Product is the service product/software name
    string product = 2;

    // Version is the service version
    string version = 3;

    // ExtraInfo contains additional service information
    string extra_info = 4;

    // Method is the detection method (probed, table)
    string method = 5;

    // Confidence is the detection confidence level (0-10)
    int32 confidence = 6;

    // CPE contains Common Platform Enumeration identifiers
    repeated string cpe = 7;

    // Hostname is the hostname from service banner (if available)
    string hostname = 8;

    // OSType is the operating system type from service
    string os_type = 9;

    // DeviceType is the device type from service
    string device_type = 10;

    // ServiceFP is the service fingerprint
    string service_fp = 11;
}

// OSMatch represents an OS detection match
message OSMatch {
    // Name is the OS name
    string name = 1;

    // Accuracy is the match accuracy (0-100)
    int32 accuracy = 2;

    // Line is the OS fingerprint line number
    int32 line = 3;

    // Classes contains OS classification information
    repeated OSClass classes = 4;
}

// OSClass represents OS classification information
message OSClass {
    // Type is the device type (general purpose, router, firewall, etc.)
    string type = 1;

    // Vendor is the OS vendor
    string vendor = 2;

    // OSFamily is the OS family (Linux, Windows, etc.)
    string os_family = 3;

    // OSGen is the OS generation (e.g., "7" for Windows 7)
    string os_gen = 4;

    // Accuracy is the classification accuracy (0-100)
    int32 accuracy = 5;

    // CPE contains Common Platform Enumeration identifiers
    repeated string cpe = 6;
}

// NmapScript represents NSE script execution result
message NmapScript {
    // ID is the script identifier
    string id = 1;

    // Output is the script output
    string output = 2;

    // Elements contains structured output elements
    map<string, string> elements = 3;
}
